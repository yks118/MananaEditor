let MananaEditor=function(g,d){this.getData=function(){return e.innerHTML};this.insertNode=function(a){let b,c;window.getSelection&&(b=window.getSelection()).rangeCount?(1===b.anchorNode.childNodes.length&&b.anchorNode.childNodes.forEach(f=>{"BR"===f.nodeName&&b.anchorNode.removeChild(f)}),c=b.getRangeAt(0),c.collapse(!0),c.insertNode(a),c.setStartAfter(a),c.collapse(!0),b.removeAllRanges(),b.addRange(c)):document.execCommand("insertHTML",null,a.outerHTML)};this.insertNodeNewLine=function(){let a;
if(window.getSelection&&(a=window.getSelection()).rangeCount){var b=document.createElement("br");let c=a.anchorNode;for(;"manana-editor"!==c.parentElement.className;)c=c.parentNode;if(3===c.nodeType)this.insertNode(b);else{let f=c.cloneNode();f.appendChild(b);c.parentNode.insertBefore(f,c.nextSibling);b=document.createRange();b.selectNodeContents(f);b.collapse(!1);a.removeAllRanges();a.addRange(b)}}};this.setCursor=function(){if(window.getSelection){let a=document.getSelection();if(null===a.focusNode||
a.getRangeAt(0).startContainer.parentNode!==e&&document.activeElement!==e){e.focus();let b=document.createRange();b.selectNodeContents(e.lastChild);b.collapse(!1);a.removeAllRanges();a.addRange(b)}}};this.setCurtain=function(){let a=document.createElement("div");a.className="manana-editor-curtain";h.appendChild(a)};this.delCurtain=function(){let a=h.querySelector(".manana-editor-curtain");null!==a&&a.remove()};this.deepMerge=function(a,b){if("undefined"!==typeof a&&"undefined"===typeof b)return a;
if(!a||"object"!==typeof a||!b||"object"!==typeof b)return b;Object.keys(b).forEach(c=>{const f=a[c],m=b[c];Array.isArray(f)&&Array.isArray(m)?a[c]=m:a[c]=f&&"object"===typeof f&&m&&"object"===typeof m?this.deepMerge(Object.assign({},f),m):m});return a};if(null===g)return console.log("Check Editor Element"),!1;this.options=this.deepMerge({toolbar:["uploadFile","uploadImage","uploadAudio","uploadVideo"],plugins:{}},d);d=g.closest("form");null!==d&&d.addEventListener("submit",a=>{g.innerHTML=this.getData()});
g.style.display="none";let h=document.createElement("div");h.className="manana-editor-wrap";let e=document.createElement("div");e.className="manana-editor";e.contentEditable="true";""!==g.innerHTML&&(d=document.createElement("template"),d.innerHTML=g.innerHTML.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'"),e.appendChild(d.content));for(var k in this)if("function"===typeof this[k]||"object"===typeof this[k])e[k]=this[k];for(var l in MananaEditor._registerPlugin)this.options.plugins[l]=
new MananaEditor._registerPlugin[l](e,this.options.plugins[l]);if("object"===typeof this.options.toolbar){k=document.createElement("ul");k.className="manana-editor-toolbar";for(l=0;l<this.options.toolbar.length;l++)d=document.createElement("li"),d.appendChild(this.options.plugins[this.options.toolbar[l]].iconElement),k.appendChild(d);h.className+=" manana-editor-toolbar";h.appendChild(k)}h.appendChild(e);g.after(h);return this};MananaEditor._registerPlugin={};
MananaEditor.registerPlugin=function(g,d){MananaEditor._registerPlugin[g]=d};
