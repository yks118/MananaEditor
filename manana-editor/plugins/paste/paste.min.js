"function"===typeof MananaEditor&&MananaEditor.registerPlugin("paste",function(e,h){this.options=e.deepMerge({image:{mode:"base64",uploadURL:null,insertNode:{_imageTag:function(d,c,b){if("undefined"===typeof b.src||!b.src)return console.log("Not Data: objResponse.src"),!1;let a=document.createElement("picture"),f=document.createElement("source");f.srcset=b.src;f.type=b.type?b.type:c.type;let g=document.createElement("img");g.alt=b.name?b.name:c.name;g.src=b.src;a.appendChild(f);a.appendChild(g);d.insertNode(a);
d.insertNodeNewLine()},base64:async function(d,c){return{src:await new Promise(b=>{let a=new FileReader;a.onload=()=>{b(a.result.toString())};a.readAsDataURL(c)})}},server:async function(d,c){if(null===d.options.plugins.paste.image.uploadURL)return console.log("Not Data: objEditor.options.plugins['paste'].image.uploadURL"),!1;let b=new FormData;b.append("file",c);return await fetch(d.options.plugins.paste.image.uploadURL,{method:"POST",body:b}).then(a=>{if(a.ok)return a.json()}).then(a=>{if("boolean"===
typeof a.status&&"string"===typeof a.message&&!1===a.status)alert(a.message);else if("undefined"===typeof a.src||!a.src)return console.log("Not Data: json.src"),!1;return a})},s3:async function(d,c){if(null===d.options.plugins.paste.image.uploadURL)return console.log("Not Data: objEditor.options.plugins['paste'].image.uploadURL"),!1;let b;b="&file[name]="+c.name;b+="&file[size]="+c.size;b+="&file[type]="+c.type;b+="&file[lastModified]="+c.lastModified;return await fetch(d.options.plugins.paste.image.uploadURL,
{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:b.substring(1)}).then(a=>a.json()).then(async a=>{if("boolean"===typeof a.status&&"string"===typeof a.message&&!1===a.status)alert(a.message);else{if("undefined"===typeof a.url||!a.url)return console.log("Not Data: json.url"),!1;if("undefined"===typeof a.src||!a.src)return console.log("Not Data: json.src"),!1}return await fetch(a.url,{method:"PUT",body:c}).then(f=>f.ok?a:!1)})}}}},h);e.addEventListener("paste",d=>{d.preventDefault();
let c=d.clipboardData;if(-1!==c.types.indexOf("Files")){if("image/png"===c.files[0].type)if(-1===c.types.indexOf("text/plain")&&-1!==c.types.indexOf("text/html")){d=c.getData("text/html");var b=document.createElement("template");b.innerHTML=d;e.insertNode(b.content.childNodes[2])}else e.setCurtain(),(async()=>{let a=c.files[0],f=await e.options.plugins.paste.image.insertNode[e.options.plugins.paste.image.mode](e,a);"string"===typeof f.src&&e.options.plugins.paste.image.insertNode._imageTag(e,a,f);
e.delCurtain()})()}else-1!==c.types.indexOf("text/plain")&&(d=c.getData("text/plain"),d=d.replace(/(https?:\/\/\S+)/,'<a rel="noopener noreferrer" target="_blank" href="$1">$1</a>'),b=document.createElement("template"),b.innerHTML=d,e.insertNode(b.content.firstChild))});return this.options});
