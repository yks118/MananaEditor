"function"===typeof MananaEditor&&MananaEditor.registerPlugin("uploadFile",function(e,f){this.options=e.deepMerge({icon:'<button type="button"><i class="far fa-file fa-fw"></i></button>',mode:"base64",accept:"*/*",uploadURL:null,insertNode:{_tag:function(b,d,c){if("undefined"===typeof c.src||!c.src)return console.log("Not Data: objResponse.src"),!1;let a=document.createElement("a");a.href=c.src;a.innerText=c.name?c.name:d.name;a.download=c.name?c.name:d.name;b.insertNode(a);b.insertNodeNewLine()},
base64:async function(b,d){return{src:await new Promise(c=>{let a=new FileReader;a.onload=()=>{c(a.result.toString())};a.readAsDataURL(d)})}},server:async function(b,d){if(null===b.options.plugins.uploadFile.uploadURL)return console.log("Not Data: objEditor.options.plugins['uploadFile'].uploadURL"),!1;let c=new FormData;c.append("file",d);return await fetch(b.options.plugins.uploadFile.uploadURL,{method:"POST",body:c}).then(a=>{if(a.ok)return a.json()}).then(a=>{if("boolean"===typeof a.status&&"string"===
typeof a.message&&!1===a.status)alert(a.message);else if("undefined"===typeof a.src||!a.src)return console.log("Not Data: json.src"),!1;return a})},s3:async function(b,d){if(null===b.options.plugins.uploadFile.uploadURL)return console.log("Not Data: objEditor.options.plugins['uploadFile'].uploadURL"),!1;let c;c="&file[name]="+d.name;c+="&file[size]="+d.size;c+="&file[type]="+d.type;c+="&file[lastModified]="+d.lastModified;return await fetch(b.options.plugins.uploadFile.uploadURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},
body:c.substring(1)}).then(a=>a.json()).then(async a=>{if("boolean"===typeof a.status&&"string"===typeof a.message&&!1===a.status)alert(a.message);else{if("undefined"===typeof a.url||!a.url)return console.log("Not Data: json.url"),!1;if("undefined"===typeof a.src||!a.src)return console.log("Not Data: json.src"),!1}return await fetch(a.url,{method:"PUT",body:d}).then(g=>g.ok?a:!1)})}}},f);f=document.createElement("template");f.innerHTML=this.options.icon;this.options.iconElement=f.content.firstChild;
this.options.iconElement.addEventListener("click",b=>{e.setCursor();b=e.closest(".manana-editor-wrap").querySelector('input[type="file"]');null!==b&&b.remove();b=document.createElement("input");b.type="file";b.accept=this.options.accept;b.style.display="none";b.multiple=!0;b.mode=this.options.mode;b.addEventListener("change",function(d){e.setCurtain();this.files&&0<this.files.length&&(async()=>{let c=e.options.plugins.uploadFile.mode;for(let a=0;a<this.files.length;a++){let g=await e.options.plugins.uploadFile.insertNode[c](e,
this.files[a]);"string"===typeof g.src&&e.options.plugins.uploadFile.insertNode._tag(e,this.files[a],g)}e.delCurtain()})();d.target.remove()});e.after(b);b.click()});return this.options});
