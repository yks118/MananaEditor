"function"===typeof MananaEditor&&MananaEditor.registerPlugin("uploadImage",function(e,g){this.options=e.deepMerge({icon:'<button type="button"><i class="far fa-file-image fa-fw"></i></button>',mode:"base64",accept:"image/*",uploadURL:null,insertNode:{_imageTag:function(b,d,c){if("undefined"===typeof c.src||!c.src)return console.log("Not Data: objResponse.src"),!1;let a=document.createElement("picture"),f=document.createElement("source");f.srcset=c.src;f.type=c.type?c.type:d.type;let h=document.createElement("img");
h.alt=c.name?c.name:d.name;h.src=c.src;a.appendChild(f);a.appendChild(h);b.insertNode(a);b.insertNodeNewLine()},base64:async function(b,d){return{src:await new Promise(c=>{let a=new FileReader;a.onload=()=>{c(a.result.toString())};a.readAsDataURL(d)})}},server:async function(b,d){if(null===b.options.plugins.uploadImage.uploadURL)return console.log("Not Data: objEditor.options.plugins['uploadImage'].uploadURL"),!1;let c=new FormData;c.append("file",d);return await fetch(b.options.plugins.uploadImage.uploadURL,
{method:"POST",body:c}).then(a=>{if(a.ok)return a.json()}).then(a=>{if("boolean"===typeof a.status&&"string"===typeof a.message&&!1===a.status)alert(a.message);else if("undefined"===typeof a.src||!a.src)return console.log("Not Data: json.src"),!1;return a})},s3:async function(b,d){if(null===b.options.plugins.uploadImage.uploadURL)return console.log("Not Data: objEditor.options.plugins['uploadImage'].uploadURL"),!1;let c;c="&file[name]="+d.name;c+="&file[size]="+d.size;c+="&file[type]="+d.type;c+=
"&file[lastModified]="+d.lastModified;return await fetch(b.options.plugins.uploadImage.uploadURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c.substring(1)}).then(a=>a.json()).then(async a=>{if("boolean"===typeof a.status&&"string"===typeof a.message&&!1===a.status)alert(a.message);else{if("undefined"===typeof a.url||!a.url)return console.log("Not Data: json.url"),!1;if("undefined"===typeof a.src||!a.src)return console.log("Not Data: json.src"),!1}return await fetch(a.url,
{method:"PUT",body:d}).then(f=>f.ok?a:!1)})}}},g);g=document.createElement("template");g.innerHTML=this.options.icon;this.options.iconElement=g.content.firstChild;this.options.iconElement.addEventListener("click",b=>{e.setCursor();b=e.closest(".manana-editor-wrap").querySelector('input[type="file"]');null!==b&&b.remove();b=document.createElement("input");b.type="file";b.accept=this.options.accept;b.style.display="none";b.multiple=!0;b.mode=this.options.mode;b.addEventListener("change",function(d){e.setCurtain();
this.files&&0<this.files.length&&(async()=>{let c=e.options.plugins.uploadImage.mode;for(let a=0;a<this.files.length;a++){let f=await e.options.plugins.uploadImage.insertNode[c](e,this.files[a]);"string"===typeof f.src&&e.options.plugins.uploadImage.insertNode._imageTag(e,this.files[a],f)}e.delCurtain()})();d.target.remove()});e.after(b);b.click()});return this.options});
